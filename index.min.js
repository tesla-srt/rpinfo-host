const{app,Tray}=require("electron"),express=require("express"),main=express(),http=require("http"),server=http.createServer(main),Server=require("socket.io")["Server"],cp=require("node:child_process"),updateWorker=cp.fork(__dirname+"/update.js"),aggregateWorker=cp.fork(__dirname+"/aggregator.js"),io=new Server(server,{cors:{origin:"*",methods:["GET","POST"]}});let port=process.env.PORT||3e3;var jsonData={CPU:{temp:"00",load:"00",clk:"00"},OS:{user:"",uptime:"00:00:00",cpumodel:"",cpuclk:"",cpuvendor:""},GPU:{vendor:"",model:"",class:"",temp:"00",load:"00",clk:"00"},RAM:{used:"",total:"",clk:"00"},HDD:[],IO:[{read:"",write:""},{read:"",write:""}],NET:{iface:"name",rx_bytes:0,tx_bytes:0,rx_sec:0,tx_sec:0,ms:0},date:0,firstrun:!0};let tray=null,r=(app.once("ready",()=>{(tray=new Tray(__dirname+"/img/icon.png")).on("double-click",function(event){tray.destroy(),tray=null,updateWorker.kill(),aggregateWorker.kill(),app.quit(),process.exit(1)}),updateWorker.send(jsonData)}),{});io.on("connection",socket=>{socket.on("update",()=>{updateWorker.send(jsonData),socket.emit("sysinfo",jsonData)}),aggregateWorker.on("message",data=>{jsonData=data})}),updateWorker.on("message",thedata=>{r={prev:jsonData,data:thedata},aggregateWorker.send(r)}),server.listen(port);